<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Edit TA APP</title>

  <style>
  #sortable1, #sortable2, #sortable3 {
    border: 1px solid #eee;
    width: 450px;
    min-height: 20px;
    list-style-type: none;
    margin: 0;
    padding: 5px 0 0 0;
    float: left;
    margin-right: 10px;
  }
  #sortable1 li, #sortable2 li, #sortable3 li{
    margin: 0 5px 5px 5px;
    padding: 5px;
    font-size: 1.0em;
    width: 450px;
  }
  </style>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
  $( function() {
    $( "#sortable1, #sortable2, #sortable3" ).sortable({
      connectWith: ".connectedSortable"
    }).disableSelection();
  } );
  </script>
</head>
<body>


<h1>Edit Application</h1>
<br>
  <p>
  </p>
  Degree Program:
  <select id = "degreeProgram">
      
  <option value="msThesis">MS Thesis</option>
  
  <option value="msNon-Thesis">MS Non-Thesis</option>
  
  <option value="phd">PhD</option>
  
</select>
  <!--<input type="submit" value="Submit">-->

  <p>
    
  </p>

  Years as a graduate student:
  <select id = "years">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
  <option value="9">9</option>
</select>

  <p>
  </p>
<form action="/action_page.php">
  Advisor: <input type="text" name="advisor" id = "advisor"><br>
  <p> </p>
  <!--<input type="submit" value="Submit">-->
</form>

<p>

</p>

<div>
Applying as:
<p></p>
   <input type="checkbox" id="taCheck"> TA
  <p></p>
   <input type="checkbox" id="gCheck"> Grader
  <p></p>
   <input type="checkbox" id="sgCheck"> Senior Grader
</div>

<script>
    
    document.getElementById('advisor').value= "<%= @object.advisor %>";
    document.getElementById("degreeProgram").value =  "<%= @object.degree_program %>";
    document.getElementById("years").value= "<%= @object.years %>";
    
    document.getElementById('taCheck').checked = <%= @object.isTA %>; 
    document.getElementById('gCheck').checked = <%= @object.isGrader %> ; 
    document.getElementById('sgCheck').checked = <%= @object.isSG %>;

</script>
  
  
<br><br>
<h2 > My Class Preferences </h2>
 <div id = "sortable1div">
<ul id="sortable1" class="connectedSortable">
 <h3> Classes I CAN teach </h3>
 <% @coursesIndif.each do |course| %>
   <li id = "<%= course.name %>" class="ui-state-default"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><%= course.course_info %></li>
  <% end %>
</ul>
 </div>

<div id = "sortable2div">
<ul id="sortable2" class="connectedSortable" >
  <h3> Class I CAN && REALLY WANT to teach </h3>
  <% @coursesPref.each do |course| %>
   <li id = "<%= course.name %>" class="ui-state-default"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><%= course.course_info %></li>
  <% end %>  
</ul>
</div>

<div id = "sortable3div">
<ul id="sortable3" class="connectedSortable" style = "color:red" title = "hello">
  <h3> Class I CANNOT teach </h3>
  <% @coursesAntiPref.each do |course| %>
   <li id = "<%= course.name %>" class="ui-state-default"><span class="ui-icon ui-icon-arrowthick-2-n-s"></span><%= course.course_info %></li>
  <% end %>  
</ul>
</div>

    <button id="submit" onclick = "convertToJSON()"> SUBMIT</button>
    <%= form_for :application, url: {action: "update"}, :method => :PATCH, :html => {:id => "payload-form"} do |form| %>
      <%= form.text_field :payload %>
      <%= form.submit "submit-payload", :id=>"payload-button" %>
    <% end %>
    
 <p></p>
 <div>

 </div>


 <script>

  var s = document.getElementById("degreeProgram");
  s.addEventListener("change", changeSelectedDP);

  function changeSelectedDP(){
    var value = s.options[s.selectedIndex].value;
  }
  changeSelectedDP();




function convertToJSON(){
    var advisor = document.getElementById('advisor').value;
    var years = document.getElementById("years").options[document.getElementById("years").selectedIndex].value;
    var degreeProg = document.getElementById("degreeProgram").options[document.getElementById("degreeProgram").selectedIndex].value;
    var listIndifferent = document.getElementById("sortable1div").getElementsByTagName("li");
    var listPref = document.getElementById("sortable2div").getElementsByTagName("li");
    var listAntipref = document.getElementById("sortable3div").getElementsByTagName("li");
    var isTA = document.getElementById('taCheck').checked;
    var isGrader = document.getElementById('gCheck').checked;
    var isSG = document.getElementById('sgCheck').checked;

    var i;
    var preferences = [];
    var antipreferences = [];
    var indifferent = [];
    i = 0;
  
    while(i < listIndifferent.length){
      indifferent.push(listIndifferent[i].id);
      i++;
    }
    i = 0;
    while(i < listPref.length){
      preferences.push(listPref[i].id);
      i++;
    }
    i = 0;
    while(i < listAntipref.length){
      antipreferences.push(listAntipref[i].id);
      i++;
    }

    

      let payload ={"advisor":advisor, "years": years,"degree_program":degreeProg, "isTA":isTA, "isGrader":isGrader, "isSG":isSG, "preferences":preferences, "indifferent":indifferent, "antipref":antipreferences};
        document.getElementById("application_payload").value = JSON.stringify(payload);
        $("#payload-form").trigger('submit.rails');
        console.log(JSON.stringify(payload));

  }
</script>

 
</body>
</html>
